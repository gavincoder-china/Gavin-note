# 分布式微服务专栏005(springboot集成Dubbo)

### 项目地址

https://github.com/xunyegege/Backend_development/tree/master/dubbo



项目搭建问题需要注意版本:

springboot是1.5.9版本

dubbo依赖在下方

---



### 1.前提准备

> #### 架构设计(生产者+注册中心+消费者)
>
> ![image-20190926152728397](https://tva1.sinaimg.cn/large/006y8mN6gy1g7cy9svmntj30ub0dltfh.jpg)
>
> ![image-20190926152703406](https://tva1.sinaimg.cn/large/006y8mN6gy1g7cy9dkqtmj30ox0gwdhe.jpg)



### 2.注册中心配置运行

> #### 1.Zookeeper
>
> zookeeper是Hadoop的开源子项目（Google Chubby的开源实现），它是一个针对大型分布式系统的可靠协调系统。
>
> #### 2.Zookeeper下载配置
>
> > ①conf/ 中改zoo_sample.cfg 为zoo.cfg
> >
> > ②启动命令 ./bin/zkServer.sh start  关闭 .....stop
>
> #### 3.可视化界面 dubbo-admin
>
> dubbo-admin：就是zookeeper的可视化管理工具
>
> https://github.com/apache/dubbo-admin/tree/master  下载后编译运行



### 3.项目搭建之包结构设计

> ![image-20190926153709591](https://tva1.sinaimg.cn/large/006y8mN6gy1g7cyjvwrdzj30dm084jsw.jpg)

> 三个子模块都是SpringBoot项目

### 4.公共Common模块

> 写接口方法与实体类
>
> ```java
> //实体类  需要序列化
> public class HelloModel implements Serializable {
> 
>     private static final long serialVersionUID = 1392165405018286312L;
>     private String name;
> 
>     public String getName() {
>         return name;
>     }
> 
>     public void setName(String name) {
>         this.name = name;
>     }
> }
> ```
>
> ```java
> //接口
> public interface HelloService {
>     HelloModel sayHello();
> }
> ```

### 5.生产者Provider模块

> #### 1.添加依赖
>
> ```java
>        <!--dubbo-->
>         <dependency>
>             <groupId>com.alibaba.boot</groupId>
>             <artifactId>dubbo-spring-boot-starter</artifactId>
>             <version>0.1.0</version>
>         </dependency>
>         <!-- 实现了注册的功能 向zookeeper注册功能-->
>         <dependency>
>             <groupId>com.101tec</groupId>
>             <artifactId>zkclient</artifactId>
>             <version>0.10</version>
>         </dependency>
>         
>         <!--这边引入的是公共模块 ,详见公共模块的信息-->
>         <dependency>
>             <groupId>com.gavin</groupId>
>             <artifactId>common</artifactId>
>             <version>1.0.0-SNAPSHOT</version>
>             <scope>compile</scope>
>         </dependency>
> ```
>
> #### 2.添加配置
>
> ```java
> server.port=9003
> dubbo.application.name=dubbo-provider
> dubbo.registry.address=zookeeper://127.0.0.1:2181
> #把service包扫描进dubbo
> dubbo.scan.base-packages=com.gavin.provider.service
> #向注册中心暴露的端口   -1是随机
> dubbo.protocol.port=-1
> ```
>
> #### 3.编写接口实现类
>
> ```java
> import com.alibaba.dubbo.config.annotation.Service;
> import com.gavin.common.model.HelloModel;
> import com.gavin.common.service.HelloService;
> 
> //这个@service注解是dubbo的,不要导入错了
> @Service
> public class HelloServiceImpl implements HelloService {
> 
>     @Override
>     public HelloModel sayHello() {
>       
>         HelloModel model = new HelloModel();
>         model.setName("hello-dubbo");
>       
>         return model;
>     }
> }
> 
> ```

> #### 4.包结构
>
> ![image-20190926161236121](https://tva1.sinaimg.cn/large/006y8mN6gy1g7czkrbam7j30bs0bn75c.jpg)

### 6.消费者Consumer模块

> #### 1.添加依赖
>
> 同生产者一致
>
> #### 2.添加配置
>
> ```java
> server.port=9004
> dubbo.application.name=dubbo-consumer
> dubbo.registry.address=zookeeper://127.0.0.1:2181
> //把controller包扫描进dubbo
> dubbo.scan.base-packages=com.gavin.consumer.controller
> ```
>
> #### 3.编写controller方法
>
> ```java
> @RestController
> @RequestMapping(value = "/v1")
> public class TestController {
>    //这个也是dubbo的包下面的
>     @Reference
>     private HelloService helloService;
> 
>     @GetMapping(value = "/say")
>     public HelloModel say() {
>         return helloService.sayHello();
> 
>     }
> 
> }
> ```
>
> #### 4.包结构
>
> ![image-20190926161347399](https://tva1.sinaimg.cn/large/006y8mN6gy1g7czlztc9tj30ba0bn753.jpg)

### 7.项目运行&效果展示

> 先运行provider模块
>
> 再运行consumer模块
>
> ![image-20190926161605857](https://tva1.sinaimg.cn/large/006y8mN6gy1g7czoevfhaj30go0coabq.jpg)
>
> ![image-20190926161622839](https://tva1.sinaimg.cn/large/006y8mN6gy1g7czop2f4pj30h2066gm6.jpg)



